/*
 * File: app/controller/CarHomeTabPanelController.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.3.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.3.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('MyApp.controller.CarHomeTabPanelController', {
    extend: 'Ext.app.Controller',

    config: {
        refs: {
            carInfoImage: '#carInfoImage',
            carSeriesList: '#carSeriesList',
            carBrandList: '#carBrandList',
            chBack: '#chBack',
            chShouYe: '#chShouYe',
            carHomeTabPanel: '#carHomeTabPanel',
            callMore: '#chcallMore',
            carBBSList: '#carBBSList',
            carBBSTabCarPanelConfirm: '#carBBSTabCarPanelConfirm',
            chMyCarTabPaneltoLogin:"#chMyCarTabPaneltoLogin",
            chMyCarTabPanelToZhuCe:"#chMyCarTabPanelToZhuCe"
        },

        control: {
            "carInfoImage": {
                tap: 'oncarInfoImageTap'
            },
            "carSeriesList": {
                itemsingletap: 'oncarSeriesListItemSingletap'
            },
            "carBrandList": {
                itemsingletap: 'oncarBrandListItemSingletap'
            },
            "chBack": {
                tap: 'onchBackButtonTap'
            },
            "chShouYe": {
                tap: 'onchShouYeButtonTap'
            },
            "carHomeTabPanel": {
                activeitemchange: 'oncarHomeTabpanelActiveItemChange'
            },
            "callMore": {
                tap: 'oncallMoreButtonTap'
            },
            "carBBSList": {
                itemsingletap: 'oncarBBSListItemSingletap'
            },
            "carBBSTabCarPanelConfirm": {
                tap: 'oncarBBSTabCarPanelConfirmButtonTap'
            },
            chMyCarTabPaneltoLogin:{
            	tap:"onchMyCarTabPaneltoLoginTap"
            },
            chMyCarTabPanelToZhuCe:{
            	tap:"onchMyCarTabPanelToZhuCeTap"
            }
        }
    },

    oncarInfoImageTap: function(image, e, eOpts) {

        back.push(image.getParent().getId());
        var infoHiddenField = Ext.getCmp("infoHiddenField");
        //     infoHiddenField.setValue(carImageUrls);
        var urls = infoHiddenField.getValue();
        var urlsArray = urls.split(",");
        //infoHiddenField.setValue("");
        var items = [];
        for(i = 1;i<urlsArray.length;i++){
            items.push({
                xtype: 'image',
                cls:'my-carousel-item-img',
                src: urlsArray[i]
            }); 
        }
        var carDetailCarousel = Ext.ComponentQuery.query("#carDetailCarousel")[0];
	    carDetailCarousel.setItems(items);
	    image.getParent().getParent().setActiveItem("#carDetailCarouselPanel");
    },

    oncarSeriesListItemSingletap: function(dataview, index, target, record, e, eOpts) {
            back.push(dataview.getParent().getId());
            var store = Ext.getStore("carInfos");
            store.load({
            	callback : function(result, operation, success) {

			        var carInfoForm = Ext.getCmp("carInfoFormPanel");
			        carInfoForm.setRecord(result[0]);
			        var carImageUrls = result[0].get("carImageUrls");
			        var carImageUrlsField = Ext.getCmp("carInfoImage");
			        carImageUrlsField.setSrc(carImageUrls[0]);
			        dataview.getParent().getParent().setActiveItem("#carInfo");
            	} 
            });
    },

    oncarBrandListItemSingletap: function(dataview, index, target, record, e, eOpts) {

        back.push(dataview.getParent().getId());
        Ext.get("chBack").show();
        var store = Ext.getStore("carSerieses");
        if(!(store.isLoaded())){
            store.load();
        }
        var carHomeTabPanel = Ext.getCmp("carHomeTabPanel");
        carHomeTabPanel.setActiveItem(0);
        var carHomeTab1 = carHomeTabPanel.getAt(0);
        carHomeTab1.setActiveItem("#carSeriesListPanel");


    },

    onchBackButtonTap: function(button, e, eOpts) {
        var backValue = back.pop();
        if(back.length==0){
        	Ext.get("chBack").hide();
        }
        button.getParent().getParent().getParent().getActiveItem().setActiveItem("#"+backValue);
    },

    onchShouYeButtonTap: function(button, e, eOpts) {
        back.splice(0,back.length);
        button.getParent().getParent().getParent().getParent().setActiveItem(0);
    },

    oncarHomeTabpanelActiveItemChange: function(container, value, oldValue, eOpts) {
        if(value.id=="chMobileCenterTab"){
        	 if(login==false){
        		 Ext.getCmp("carBasePanel").setActiveItem("#loginPanel");
        		 back.push([container.id,value.id]);
        	 }else{
        		 location.href = "tel:" + 037188888880;
        	 }
        }
        if(value.id=="chServiceTab"){
            var serviceBusinesses = Ext.getStore("serviceBusinesses");
            if(!(serviceBusinesses.isLoaded())){
                serviceBusinesses.load();
            }
        }
        if(value.id=="chBBSTab"){
            var carBBSs = Ext.getStore("carBBSs");
            if(!(carBBSs.isLoaded())){
                carBBSs.load();
            }
            container.getComponent("carHomeTabBar").getScrollable().getScroller().scrollToEnd();
        }
        value.setActiveItem(0);
        Ext.get("chBack").hide();
    },

    oncallMoreButtonTap: function(button, e, eOpts) {

        location.href = "tel:" + 037188888880;
    },

    oncarBBSListItemSingletap: function(dataview, index, target, record, e, eOpts) {
        back.push(dataview.getParent().id);
        var carBBSTabPaneCars = Ext.getStore("carBBSTabPaneCars");
        if(!(carBBSTabPaneCars.isLoaded())){
            carBBSTabPaneCars.load();
        }
        Ext.get("chBack").show();
        
        Ext.getCmp("carBBSTabCalPanelTheamName").
        setHtml("<table align='center' ><tr><td width='25%' style='font-size:16pt;font-weight:bold'>主题：</td><td>"+record.get("name")+"</td></tr></table>");
        dataview.getParent().getParent().setActiveItem("#carBBSLeaveMessage");
    },

    oncarBBSTabCarPanelConfirmButtonTap: function(button, e, eOpts) {
        var leaveMessageField = Ext.getCmp("carBBSTabCarPanelLeaveMessage");//鑾峰緱杞﹁締璁哄潧鐣欒█field缁勪欢
        var store = Ext.getStore("carBBSTabPaneCars");//杞﹁締璁哄潧store
        var list = Ext.getCmp("carBBSTabPaneCarlList");
        list = Ext.ComponentQuery.query("#carBBSTabPaneCarlList");
        var model = Ext.create("MyApp.model.CarBBSTabPaneCarModel",{//鏍规嵁鐣欒█鍐呭鍒涘缓杞﹁締璁哄潧store寮曠敤鐨刴odel瀹炰緥
            "username":"xiaoxiao",
            "text": leaveMessageField.getValue()
        });
        store.add(model);
        leaveMessageField.setValue("");
    },
    onchMyCarTabPaneltoLoginTap:function(button,e,eOpts){
    	Ext.getCmp("carBasePanel").setActiveItem("#loginPanel");
    },
    onchMyCarTabPanelToZhuCeTap:function(button,e,eOpts){
    	Ext.getCmp("carBasePanel").setActiveItem("#zhucePanel");
    }
});