/*
 * File: app/controller/CheckCarTabPanel.js
 *
 * This file was generated by Sencha Architect version 2.2.3.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Sencha Touch 2.3.x library, under independent license.
 * License of Sencha Architect does not include license for Sencha Touch 2.3.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */
Ext.define("MyApp.controller.CheckCarTabPanelController",{
	extend:'Ext.app.Controller',
	config:{
		refs:{
			ccBack:"#ccBack",
			ccShouYe:'#ccShouYe',
			checkCarTabPanel:"#checkCarTabPanel",
			checkCarMainList:'#checkCarMainList',
			cccallMore:'#cccallMore',
			checkCarBBSPanelList:"#checkCarBBSPanelList",
			checkCarBBSLMPConfirm:'#checkCarBBSLMPConfirm'
		},
		control:{
			"ccBack":{
				tap:"onccBackButtonTap"
			},
			"ccShouYe":{
				tap:"onccShouYeButtonTap"
			},
			cccallMore:{
				tap:'oncccallMoreButtonTap'
			},
			checkCarTabPanel:{
				activeitemchange:"oncheckCarTabPanelActiveitemchange"
			},
			checkCarMainList:{
				itemsingletap:"oncheckCarMainListitemsingletap"
			},
			checkCarBBSPanelList:{
				itemsingletap:"oncheckCarBBSPanelListitemsingletap"
			},
			checkCarBBSLMPConfirm:{
				tap:"oncheckCarBBSLMPConfirmButtonTap"
			}
		},
	},
	oncheckCarBBSPanelListitemsingletap:function(dataview, index, target, record, e, eOpts){
		Ext.getStore("checkCarBBSLMPS").load();
		Ext.getCmp("checkCarBBSLMPTheamName")
		.setHtml("<table align='center' ><tr><td width='25%' " +
				"style='font-size:16pt;font-weight:bold'>" +
				"主题：</td><td>"+record.get("theamName")+"</td></tr></table>");
		dataview.getParent().getParent().setActiveItem("#checkCarBBSLeaveMessagePanel");
		back.push(dataview.getParent().getId());
		Ext.getCmp("ccBack").show();
	},
	onccBackButtonTap:function(button, e, eOpts) {
		
		var backValue = back.pop();
	    /*if(backValue.length==3){
	        button.getParent().getParent().getParent().getParent().setActiveItem(0);//跳转到mainPanel
	    }else if(backValue.length==2){
	        //var tabPanel = button.getParent().getParent().getParent();
	        //tabPanel.setActiveItem("#"+backValue[0]);//鍒╃敤缂撳瓨涓嶇敤鍐嶅線涓嬭缃產ctiveItem浜�
	        //back.pop();
	        back.splice(0,back.length);//清空back数组
	        button.getParent().getParent().getParent().getParent().setActiveItem(0);//回首页
	
	    }else{
	    */
	        button.getParent().getParent().getParent().getActiveItem().setActiveItem("#"+backValue);
	    //}
	        if(back.length==0){
	        	Ext.getCmp("ccBack").hide();
	        }
	    
	},
	onccShouYeButtonTap:function(button,e,eOpts){
		back.splice(0,back.length);
		button.getParent().getParent().getParent().getParent().setActiveItem(0);
	},
	oncheckCarTabPanelActiveitemchange:function(container, value, oldValue, eOpts) {
       // back.push([oldValue.id,oldValue.getActiveItem().id]);
        //濡傛灉鐐瑰嚮鐨勬槸鍛煎彨涓績锛屽氨鍛煎彨璇ュ彿鐮�
        if(value.id=="ccMobileCenterTab"){
            location.href = "tel:" + 037188888880;
        }else if(value.id=="ccBBSTab"){
            /*var carBBSs = Ext.getStore("carBBSs");
            if(!(carBBSs.isLoaded())){
                carBBSs.load();
            }
            container.getComponent("carHomeTabBar").getScrollable().getScroller().scrollToEnd();
        	*/
        	Ext.getStore("checkCarBBSs").load();
        	
        }
        Ext.get("ccBack").hide();
        value.setActiveItem(0);
    },
    oncheckCarMainListitemsingletap:function(dataview, index, target, record, e, eOpts){
    	
    	var store = Ext.getStore("checkCarDetails");
    	var proxy = store.getProxy();
    	var itemName = record.get("checkText");
    	if(itemName=="审车须知"){
    		proxy.setUrl("checkCarKits.json");
    	}else if(itemName=="审车流程"){
    		proxy.setUrl("checkCarProcess.json");
    	}else{
    		//TODO代理人这块没写
    		//proxy.setUrl("checkCarAgent.json");
    	}
    	
    	store.load();
    	dataview.getParent().getParent().setActiveItem(1);
    	back.push(dataview.getParent().getId());
    	Ext.getCmp("ccBack").show();
    },
    oncccallMoreButtonTap:function(button,e,eOpts){
    	location.href = "tel:" + 037188888880;
    },
    oncheckCarBBSLMPConfirmButtonTap:function(button,e,eOpts){
    	var store = Ext.getStore("checkCarBBSLMPS");
    	var textField = Ext.getCmp("checkCarBBSLMPTextAreaField");
    	var model = Ext.create("MyApp.model.CheckCarBBSLMP",{
    		"username":"xiaoxiao",
    		"text":textField.getValue()
    	});
    	store.add(model);
    	textField.setValue('');
    }
});